import { useCallback, useState } from 'react'
import { useTranslation } from 'react-i18next'
import { motion } from 'framer-motion'
import { Upload, File, X } from 'lucide-react'
import { cn } from '@/lib/utils'

interface UploadZoneProps {
  onFilesSelected: (files: File[]) => void
  disabled?: boolean
}

export function UploadZone({ onFilesSelected, disabled }: UploadZoneProps) {
  const { t } = useTranslation()
  const [isDragOver, setIsDragOver] = useState(false)

  const handleDragOver = useCallback((e: React.DragEvent) => {
    e.preventDefault()
    setIsDragOver(true)
  }, [])

  const handleDragLeave = useCallback((e: React.DragEvent) => {
    e.preventDefault()
    setIsDragOver(false)
  }, [])

  const handleDrop = useCallback((e: React.DragEvent) => {
    e.preventDefault()
    setIsDragOver(false)
    
    if (disabled) return

    const droppedFiles = Array.from(e.dataTransfer.files)
    onFilesSelected(droppedFiles)
  }, [disabled, onFilesSelected])

  const handleFileInput = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
    if (disabled) return
    const selectedFiles = Array.from(e.target.files || [])
    onFilesSelected(selectedFiles)
    e.target.value = ''
  }, [disabled, onFilesSelected])

  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      className={cn(
        "relative border-2 border-dashed rounded-xl p-8 transition-all duration-300 cursor-pointer",
        isDragOver 
          ? "border-primary bg-primary/5 scale-[1.02]" 
          : "border-muted-foreground/25 hover:border-muted-foreground/50",
        disabled && "opacity-50 cursor-not-allowed"
      )}
      onDragOver={handleDragOver}
      onDragLeave={handleDragLeave}
      onDrop={handleDrop}
      onClick={() => !disabled && document.getElementById('file-input')?.click()}
    >
      <input
        id="file-input"
        type="file"
        multiple
        className="hidden"
        onChange={handleFileInput}
        disabled={disabled}
      />
      
      <div className="flex flex-col items-center justify-center space-y-3 text-center">
        <motion.div
          animate={isDragOver ? { scale: 1.1, y: -5 } : { scale: 1, y: 0 }}
          className="p-4 rounded-full bg-muted"
        >
          <Upload className={cn(
            "h-8 w-8 transition-colors",
            isDragOver ? "text-primary" : "text-muted-foreground"
          )} />
        </motion.div>
        
        <div className="space-y-1">
          <p className="text-sm font-medium">
            {t('home.dragDrop')}
          </p>
          <p className="text-xs text-muted-foreground">
            {t('home.orClick')}
          </p>
        </div>

        <div className="flex items-center space-x-4 text-xs text-muted-foreground">
          <span className="flex items-center">
            <File className="h-3 w-3 mr-1" />
            {t('home.maxFiles')}
          </span>
          <span>â€¢</span>
          <span>{t('home.allExtensions')}</span>
        </div>
      </div>
    </motion.div>
  )
}
